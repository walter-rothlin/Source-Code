{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h1>{{ details.ID }} {{ details.Anrede_Long_Long }} {{ details.Geburtstag }}</h1>


    <form id="updateForm" method="post" action="{{ url_for('update_person_details') }}">
        <INPUT TYPE="HIDDEN" NAME="ID" VALUE="{{ details.ID }}">
        <div class="form-row">
            <div class="form-group col-md-1">
                <label for="geschlecht" class="col-form-label">Geschlecht:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="geschlecht" name="Sex" maxlength="5" value="{{ details.Geschlecht }}" onchange="markChangedFields()" required>
                </div>
            </div>
            <div class="form-group col-md-1">
                <label for="vorname" class="col-form-label">Vorname:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="vorname" name="Vorname" maxlength="45" value="{{ details.Vorname }}" onchange="markChangedFields()" required>
                </div>
            </div>
            <div class="form-group col-md-1">
                <label for="vorname_2" class="col-form-label">2.Vorname:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="vorname_2" name="Vorname_2" maxlength="45" value="{{ details.Vorname_2 }}" onchange="markChangedFields()">
                </div>
            </div>
            <div class="form-group col-md-2">
                <label for="ledig_name" class="col-form-label">Ledig Name:</label>
                <input type="text" class="form-control" id="ledig_name" name="Ledig_Name" maxlength="45" value="{{ details.Ledig_Name }}" onchange="markChangedFields()" required>
            </div>
            <div class="form-group col-md-2">
                <label for="partner_name" class="col-form-label">Partner Name:</label>
                <input type="text" class="form-control" id="partner_name" name="Partner_Name" maxlength="45" value="{{ details.Partner_Name }}" onchange="markChangedFields()">
            </div>
            <div class="form-group col-md-3">
                <label for="partner_name_angenommen" class="col-form-label">Partner Name angenommen:</label>
                <input type="text" class="form-control" id="partner_name_angenommen" name="Partner_Name_Angenommen" maxlength="1" value="{{ details.Partner_Name_Angenommen }}" onchange="markChangedFields()" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="history" class="col-form-label">History:</label>
                <input type="text" class="form-control" id="history" name="History" maxlength="500" value="{{ details.History }}" onchange="markChangedFields()" >
            </div>

            <div class="form-group col-md-4">
                <label for="bemerkungen" class="col-form-label">Bemerkungen:</label>
                <input type="text" class="form-control" id="bemerkungen" name="Bemerkungen" maxlength="500" value="{{ details.Bemerkungen }}" onchange="markChangedFields()" >
            </div>

        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="kategorien" class="col-form-label">Kategorien:</label>
                <input type="text" class="form-control" id="kategorien" name="Kategorien" maxlength="500" value="{{ details.Kategorien }}" onchange="markChangedFields()" >
            </div>
        </div>


        <div class="form-row">
            <div class="form-group col-md-2">
                <label for="zivilstand" class="col-form-label">Zivilstand:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="zivilstand" name="Zivilstand" maxlength="50" value="{{ details.Zivilstand }}" onchange="markChangedFields()" >
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-2">
                <label for="geburtstag" class="col-form-label">Geburtsdatum:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="geburtstag" name="Geburtstag" maxlength="10" value="{{ details.Geburtstag }}" onchange="markChangedFields()" >
                </div>
            </div>
            <div class="form-group col-md-2">
                <label for="todestag" class="col-form-label">Todestag:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="todestag" name="Todestag" maxlength="10" value="{{ details.Todestag }}" onchange="markChangedFields()" >
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="partner_id" class="col-form-label">Partner_ID {% if details.Partner_Reference  != None and details.Partner_Reference  != '' %} [<B>{{ details.Partner_Reference }}</B>]{% endif %}:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="partner_id" name="Partner_ID" maxlength="5" value="{{ details.Partner_ID }}" onchange="markChangedFields()" >
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="vater_id" class="col-form-label">Vater_ID {% if details.Vater_Reference  != None and details.Vater_Reference  != '' %} [<B>{{ details.Vater_Reference }}</B>]{% endif %}:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="vater_id" name="Vater_ID" maxlength="5" value="{{ details.Vater_ID }}" onchange="markChangedFields()" >
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="mutter_id" class="col-form-label">Mutter_ID {% if details.Mutter_Reference  != None and details.Mutter_Reference  != '' %} [<B>{{ details.Mutter_Reference }}</B>]{% endif %}:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="mutter_id" name="Mutter_ID" maxlength="5" value="{{ details.Mutter_ID }}" onchange="markChangedFields()" >
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">&Auml;nderungen speichern</button>
        <!-- <button type="button" class="btn btn-primary" onclick="updateValues()">&Auml;nderungen speichern</button> -->
        <button type="reset" class="btn btn-secondary">Reset</button>
    </form>

    <!-- Add Bootstrap JS and Popper.js scripts (required for Bootstrap components) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        function updateValues() {
            // Get values from the form
            var anrede = document.getElementById("anrede").value;
            var firstName = document.getElementById("firstName").value;
            var ledigName = document.getElementById("ledigName").value;
            var partnerName = document.getElementById("partnerName").value;
            var partnerNameAngenommen = document.getElementById("partnerNameAngenommenYes").checked ? "Yes" : "No";
            var Kategorie_Buerger = document.getElementById("Kategorie_Buerger").checked;
            var Kategorie_Nutzungsberechtigt = document.getElementById("Kategorie_Nutzungsberechtigt").checked;
            var Kategorie_Verwaltungsberechtigt = document.getElementById("Kategorie_Verwaltungsberechtigt").checked;
            var dob = document.getElementById("dob").value;

            // Perform the update or send values to the server using AJAX
            // For simplicity, this example just logs the values to the console
            console.log("Updating values:");
            console.log("Anrede: " + anrede);
            console.log("Vorname: " + firstName);
            console.log("Ledig Name: " + ledigName);
            console.log("Partner Name: " + partnerName);
            console.log("Partner Name Angenommen: " + partnerNameAngenommen);
            console.log("Kategorie BÃ¼rger: " + Kategorie_Buerger);
            console.log("Kategorie Nutzungsberechtigt: " + Kategorie_Nutzungsberechtigt);
            console.log("Kategorie Verwaltungsberechtigt: " + Kategorie_Verwaltungsberechtigt);
            console.log("Geburtsdatum: " + dob);

            // You can add further logic here to update values in the database or perform other actions
            submitForm()

            // Mark changed input fields with a red background
            // markChangedFields();
        }

        var defaultValues = {};

        function markChangedFields(element) {
            // Get all input elements in the form
            var fieldId = element.id;
            var inputElements = document.querySelectorAll('#updateForm input');
            console.log(inputElements)

            // Loop through each input element
            inputElements.forEach(function (element) {
                console.log(element, element.defaultValue, '-->', element.value)
                if (element.defaultValue !== element.value) {
                    element.classList.add('changed');
                } else {
                    element.classList.remove('changed');
                }
            });
        }

        function submitForm() {
            // Get values from the form
            var anrede = document.getElementById("anrede").value;
            var vorname = document.getElementById("vorname").value;
            // Add other fields as needed...

            // Prepare the data to be sent in the PUT request
            var data = {
                anrede: anrede,
                vorname: vorname,
                // Add other fields as needed...
            };

            // Make a PUT request using the fetch API
            fetch('/update/details', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Update successful:', data);
            })
            .catch(error => {
                console.error('Error during update:', error);
            });
        }
    </script>
</div>
{% endblock %}